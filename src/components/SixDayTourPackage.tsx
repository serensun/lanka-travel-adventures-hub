import React, { useState } from 'react';
import { Check, X, Users, Calendar, MapPin, Camera, MessageSquare, Star, Clock, CreditCard, Shield, ZoomIn, ChevronLeft, ChevronRight, ChevronDown, ChevronUp, Car } from 'lucide-react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Carousel, CarouselContent, CarouselItem, CarouselNext, CarouselPrevious } from '@/components/ui/carousel';
import { Dialog, DialogContent, DialogTrigger } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import BookingForm from './BookingForm';
import galleryImage1 from "@/assets/sri-lanka-6-day-1.avif";
import galleryImage2 from "@/assets/sri-lanka-6-day-2.avif";
import galleryImage3 from "@/assets/sri-lanka-6-day-3.avif";
import galleryImage4 from "@/assets/sri-lanka-6-day-4.avif";
import galleryImage5 from "@/assets/sri-lanka-6-day-5.avif";
import galleryImage6 from "@/assets/sri-lanka-6-day-6.avif";

const SixDayTourPackage = () => {
  const [selectedPackage, setSelectedPackage] = useState('standard');
  const [travelers, setTravelers] = useState(2);
  const [comments, setComments] = useState('');
  const [currentImageIndex, setCurrentImageIndex] = useState(0);
  const [isDialogOpen, setIsDialogOpen] = useState(false);
  const [showExpandedItinerary, setShowExpandedItinerary] = useState(false);

  const packageRates = {
    standard: { double: 599, single: 850 },
    comfort: { double: 895, single: 1155 },
    luxury: { double: 1199, single: 1599 }
  };

  const galleryImages = [
    {
      url: galleryImage1,
      alt: 'Sri Lanka Wildlife Safari',
      caption: 'Experience amazing wildlife at Yala National Park'
    },
    {
      url: galleryImage2,
      alt: 'Cultural Triangle',
      caption: 'Explore ancient cities and UNESCO heritage sites'
    },
    {
      url: galleryImage3,
      alt: 'West Coast Beaches',
      caption: 'Relax on pristine golden beaches'
    },
    {
      url: galleryImage4,
      alt: 'Tea Country',
      caption: 'Walk through emerald tea plantations'
    },
    {
      url: galleryImage5,
      alt: 'Hill Country Train',
      caption: 'Experience scenic train journeys'
    },
    {
      url: galleryImage6,
      alt: 'Botanical Gardens',
      caption: 'Visit lush tropical gardens'
    }
  ];

  const highlights = [
    'Yala National Park Safari - Spot leopards, elephants, and exotic birds in their natural habitat',
    'Cultural Triangle Exploration - Discover UNESCO-listed ancient cities and majestic monuments',
    'West Coast Beach Escape - Unwind on golden sands with turquoise waters',
    'Tea Country & Botanic Gardens - Walk through emerald tea plantations and lush tropical gardens',
    'Hill Country Train Journey - Experience one of the world\'s most scenic railway routes'
  ];

  const inclusions = [
    '5 nights of hotel accommodation in standard hotels',
    '5 breakfasts and 5 Dinners',
    'Airport pickup and drop-off',
    'All sightseeing tours as per the tour itinerary',
    'Ella sightseeing tour with Mini Adam\'s peak hike, nine arch bridge visit',
    'Waterfall visit',
    'Transport in an air-conditioned vehicle',
    'Tea factory and garden visit',
    'Entrance fees to dambulla golden temple',
    'Entrance fees to sacred tooth relic temple',
    'Sigiriya guided rock fortress tour',
    'Anuradhapura and Polonnaruwa guided tour',
    'Friendly, experienced driver/guide',
    'All expenses for the train journey',
    'Kandy city tour',
    'Galle fort guided tour',
    'Ceylon tea trail',
    'Nuwara Eliya city tour',
    'Guided spice garden tour with traditional head massage',
    'All government taxes',
    'Meeting arrangements at the hotel or airport'
  ];

  const exclusions = [
    'Lunch and drinks',
    'Safari entrance fees and jeep hire',
    'Entrance fees to Anuradhapura',
    'Entrance fees Polonnaruwa',
    'Entrance fees Sigiriya guided rock fortress',
    'River safari',
    'Royal botanical garden',
    'Gratuities'
  ];

  const itineraryData = [
    { 
      day: 1, 
      title: "Arrival / Sigiriya", 
      time: "Full Day",
      highlights: "Airport Transfer, Sigiriya Village Tour",
      description: "Meet and greet at the airport. Transfer to Sigiriya. En route, stop for a village tour experience. Check-in at the hotel and leisure time."
    },
    { 
      day: 2, 
      title: "Sigiriya / Polonnaruwa / Sigiriya", 
      time: "Full Day",
      highlights: "Sigiriya Rock Fortress, Polonnaruwa Ancient City",
      description: "Early morning climb the iconic Sigiriya Rock Fortress. After lunch, explore Polonnaruwa ancient city with its well-preserved ruins and UNESCO World Heritage sites."
    },
    { 
      day: 3, 
      title: "Sigiriya / Kandy", 
      time: "Full Day",
      highlights: "Dambulla Cave Temple, Spice Garden, Kandy City",
      description: "Visit Dambulla Golden Cave Temple complex. Stop at a spice garden in Matale. Continue to Kandy and explore the city including the Temple of the Tooth Relic."
    },
    { 
      day: 4, 
      title: "Kandy / Nuwara Eliya", 
      time: "Full Day",
      highlights: "Botanical Gardens, Tea Factory, Hill Country",
      description: "Visit the Royal Botanical Gardens in Peradeniya. Journey to Nuwara Eliya via tea country, stopping at a tea factory and plantation."
    },
    { 
      day: 5, 
      title: "Nuwara Eliya / Yala", 
      time: "Full Day",
      highlights: "Hill Country Train, Ella, Safari Preparation",
      description: "Take the scenic hill country train from Nanu Oya to Ella. Explore Ella including Mini Adam's Peak and Nine Arch Bridge. Continue to Yala for safari preparation."
    },
    { 
      day: 6, 
      title: "Yala / Galle / Departure", 
      time: "Full Day",
      highlights: "Yala Safari, Galle Fort, Beach Time",
      description: "Early morning Yala National Park safari. Continue to the west coast, visit Galle Fort, and enjoy some beach time before departure transfer."
    }
  ];

  const itinerary = [
    { day: 1, title: 'Arrival / Sigiriya', activities: ['Airport Transfer', 'Sigiriya Village Tour', 'Hotel Check-in', 'Leisure Time'] },
    { day: 2, title: 'Sigiriya / Polonnaruwa / Sigiriya', activities: ['Sigiriya Rock Fortress', 'Polonnaruwa Ancient City', 'UNESCO Heritage Sites', 'Historical Monuments'] },
    { day: 3, title: 'Sigiriya / Kandy', activities: ['Dambulla Cave Temple', 'Spice Garden Visit', 'Kandy City Tour', 'Temple of Tooth Relic'] },
    { day: 4, title: 'Kandy / Nuwara Eliya', activities: ['Royal Botanical Gardens', 'Tea Factory Visit', 'Tea Plantation Tour', 'Hill Country Drive'] },
    { day: 5, title: 'Nuwara Eliya / Yala', activities: ['Hill Country Train', 'Ella Sightseeing', 'Mini Adams Peak', 'Nine Arch Bridge'] },
    { day: 6, title: 'Yala / Galle / Departure', activities: ['Yala National Park Safari', 'Galle Fort Visit', 'Beach Time', 'Departure Transfer'] }
  ];

  const getTotalPrice = () => {
    if (travelers === 1) {
      return packageRates[selectedPackage].single;
    } else {
      return packageRates[selectedPackage].double * travelers;
    }
  };

  const getPackageColor = (pkg: string) => {
    switch (pkg) {
      case 'standard': return 'from-blue-500 to-blue-700';
      case 'comfort': return 'from-blue-600 to-blue-800';
      case 'luxury': return 'from-blue-700 to-blue-900';
      default: return 'from-blue-500 to-blue-700';
    }
  };

  return (
    <div className="space-y-8">
      <div className="text-center space-y-4">
        <h2 className="text-4xl font-bold text-blue-900 mb-4">
          6-Day Sri Lanka Cultural Triangle, Wildlife & West Coast Tour
        </h2>
        <p className="text-xl text-blue-700 max-w-4xl mx-auto">
          Explore UNESCO heritage sites, experience wildlife safari, enjoy scenic train journeys, and relax on pristine beaches.
        </p>
        
        {/* Tour Features */}
        <div className="flex flex-wrap justify-center gap-4 mt-6">
          <Badge variant="secondary" className="flex items-center gap-2">
            <Shield className="w-4 h-4" />
            Free cancellation
          </Badge>
          <Badge variant="secondary" className="flex items-center gap-2">
            <CreditCard className="w-4 h-4" />
            Reserve now & pay later
          </Badge>
          <Badge variant="secondary" className="flex items-center gap-2">
            <Clock className="w-4 h-4" />
            Duration: 6 days
          </Badge>
          <Badge variant="secondary" className="flex items-center gap-2">
            <Users className="w-4 h-4" />
            Small group: Private tour
          </Badge>
        </div>
        
        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 max-w-2xl mx-auto">
          <p className="text-yellow-800 text-sm">
            <strong>Free cancellation:</strong> Cancel up to 24-hours in advance for a full refund<br/>
            <strong>Reserve now & pay later:</strong> Keep your travel plans flexible â€” book your spot and pay nothing today.<br/>
            <strong>Live tour guide:</strong> English, Italian, French
          </p>
        </div>
      </div>

      {/* Image Gallery */}
      <div className="bg-blue-50/70 backdrop-blur-sm rounded-xl p-6 border border-blue-200">
        <h3 className="text-xl font-bold text-blue-900 mb-6 text-center">Tour Gallery</h3>
        <Carousel className="w-full max-w-4xl mx-auto">
          <CarouselContent>
            {galleryImages.map((image, index) => (
              <CarouselItem key={index} className="md:basis-1/2 lg:basis-1/3">
                 <Dialog>
                   <DialogTrigger asChild>
                     <div 
                       className="relative group overflow-hidden rounded-lg cursor-pointer"
                       onClick={() => setCurrentImageIndex(index)}
                     >
                       <img
                         src={image.url}
                         alt={image.alt}
                         className="w-full h-64 object-cover transition-transform duration-500 group-hover:scale-125"
                       />
                       <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                         <ZoomIn className="h-8 w-8 text-white mb-16" />
                       </div>
                       <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
                         <p className="text-white text-sm p-4 font-medium">{image.caption}</p>
                       </div>
                     </div>
                   </DialogTrigger>
                   <DialogContent className="max-w-4xl w-full max-h-[90vh] p-2">
                     <div className="relative">
                       <img 
                         src={galleryImages[currentImageIndex].url} 
                         alt={galleryImages[currentImageIndex].alt}
                         className="w-full h-auto object-contain max-h-[80vh] rounded-lg"
                       />
                       
                       {/* Previous Arrow */}
                       <button
                         onClick={() => setCurrentImageIndex(prev => prev > 0 ? prev - 1 : galleryImages.length - 1)}
                         className="absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-all duration-200"
                         aria-label="Previous image"
                       >
                         <ChevronLeft className="h-6 w-6" />
                       </button>
                       
                       {/* Next Arrow */}
                       <button
                         onClick={() => setCurrentImageIndex(prev => prev < galleryImages.length - 1 ? prev + 1 : 0)}
                         className="absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-all duration-200"
                         aria-label="Next image"
                       >
                         <ChevronRight className="h-6 w-6" />
                       </button>
                       
                       {/* Image Counter */}
                       <div className="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/50 text-white px-3 py-1 rounded-full text-sm">
                         {currentImageIndex + 1} / {galleryImages.length}
                       </div>
                     </div>
                   </DialogContent>
                 </Dialog>
              </CarouselItem>
            ))}
          </CarouselContent>
          <CarouselPrevious />
          <CarouselNext />
        </Carousel>
      </div>

      {/* Highlights Section */}
      <div className="bg-blue-50/70 backdrop-blur-sm rounded-xl p-6 border border-blue-200">
        <h3 className="text-xl font-bold text-blue-900 mb-6 flex items-center">
          <Star className="w-5 h-5 mr-2 text-yellow-500" />
          Tour Highlights
        </h3>
        <ul className="space-y-3">
          {highlights.map((highlight, index) => (
            <li key={index} className="flex items-start space-x-3">
              <Star className="w-4 h-4 text-yellow-500 mt-0.5 flex-shrink-0" />
              <span className="text-blue-800">{highlight}</span>
            </li>
          ))}
        </ul>
      </div>

      <div className="grid lg:grid-cols-3 gap-8">
        {/* Tour Details */}
        <div className="lg:col-span-2 space-y-6">
          {/* Itinerary with Tabs */}
          <div className="bg-blue-50/70 backdrop-blur-sm rounded-xl p-6 border border-blue-200">
            <h3 className="text-xl font-bold text-blue-900 mb-6 flex items-center">
              <Car className="w-5 h-5 mr-2 text-orange-500" />
              6-Day Detailed Itinerary
            </h3>
            
            <Tabs defaultValue="overview" className="w-full">
              <TabsList className="grid w-full grid-cols-2 mb-6">
                <TabsTrigger value="overview">Overview</TabsTrigger>
                <TabsTrigger value="detailed">Detailed Day-by-Day</TabsTrigger>
              </TabsList>
              
              <TabsContent value="overview" className="space-y-4">
                <div className="grid md:grid-cols-2 gap-4">
                  {itinerary.map((day) => (
                    <div key={day.day} className="bg-white/60 rounded-lg p-4 border border-blue-100">
                      <div className="flex items-center space-x-3 mb-2">
                        <div className="bg-orange-400 text-white w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs">
                          {day.day}
                        </div>
                        <h4 className="text-blue-900 font-medium text-sm">{day.title}</h4>
                      </div>
                      <p className="text-blue-700 text-xs">{day.activities.length} activities planned</p>
                    </div>
                  ))}
                </div>
              </TabsContent>
              
              <TabsContent value="detailed" className="space-y-6">
                {itinerary.map((day) => (
                  <div key={day.day} className="border-l-4 border-orange-400 pl-6">
                    <div className="flex items-center space-x-3 mb-3">
                      <div className="bg-orange-400 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm">
                        {day.day}
                      </div>
                      <h4 className="text-blue-900 font-semibold text-lg">{day.title}</h4>
                    </div>
                    <ul className="space-y-2">
                      {day.activities.map((activity, index) => (
                        <li key={index} className="flex items-start space-x-2">
                          <MapPin className="w-4 h-4 text-orange-400 mt-0.5 flex-shrink-0" />
                          <span className="text-blue-800 text-sm">{activity}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                ))}
              </TabsContent>
            </Tabs>
          </div>

          {/* Package Selection */}
          <div className="bg-blue-50/70 backdrop-blur-sm rounded-xl p-6 border border-blue-200">
            <h3 className="text-xl font-bold text-blue-900 mb-4">Select Package Type</h3>
            <div className="grid md:grid-cols-3 gap-4">
              {Object.entries(packageRates).map(([pkg, rates]) => (
                <button
                  key={pkg}
                  onClick={() => setSelectedPackage(pkg)}
                  className={`p-4 rounded-lg text-left transition-all transform hover:scale-105 ${
                    selectedPackage === pkg
                      ? `bg-gradient-to-r ${getPackageColor(pkg)} text-white shadow-lg`
                      : 'bg-white/70 text-blue-800 hover:bg-white/90 border border-blue-200'
                  }`}
                >
                  <div className="font-semibold capitalize mb-2">{pkg} Package</div>
                  <div className="text-sm">
                    <div>${rates.double} p.p (twin sharing)</div>
                    <div>${rates.single} (single rate)</div>
                  </div>
                </button>
              ))}
            </div>
          </div>

          {/* Travelers */}
          <div className="bg-blue-50/70 backdrop-blur-sm rounded-xl p-6 border border-blue-200">
            <h3 className="text-xl font-bold text-blue-900 mb-4 flex items-center">
              <Users className="w-5 h-5 mr-2" />
              Number of Travelers (1-10)
            </h3>
            <div className="space-y-4">
              <div className="flex items-center space-x-4">
                <label htmlFor="travelers" className="text-blue-900 font-medium">
                  Travelers:
                </label>
                <input
                  id="travelers"
                  type="number"
                  min="1"
                  max="10"
                  value={travelers}
                  onChange={(e) => setTravelers(Math.max(1, Math.min(10, parseInt(e.target.value) || 1)))}
                  className="bg-white/70 text-blue-900 placeholder-blue-500 border border-blue-300 px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-20 text-center"
                />
              </div>
              <div className="text-blue-700 text-sm">
                {travelers === 1 ? (
                  <p>Single traveler rate applies</p>
                ) : (
                  <p>Twin sharing rate: ${packageRates[selectedPackage].double} per person</p>
                )}
              </div>
            </div>
          </div>

          {/* Comments Section */}
          <div className="bg-blue-50/70 backdrop-blur-sm rounded-xl p-6 border border-blue-200">
            <h3 className="text-xl font-bold text-blue-900 mb-4 flex items-center">
              <MessageSquare className="w-5 h-5 mr-2" />
              Comments & Special Requests
            </h3>
            <div className="space-y-4">
              <Label htmlFor="comments" className="text-blue-900 font-medium">
                Tell us about your preferences, dietary requirements, or any special requests:
              </Label>
              <Textarea
                id="comments"
                value={comments}
                onChange={(e) => setComments(e.target.value)}
                placeholder="e.g., vegetarian meals, accessibility needs, celebration occasions, preferred activities..."
                rows={4}
                className="bg-white/70 text-blue-900 placeholder-blue-500 border border-blue-300 focus:ring-2 focus:ring-blue-500 resize-none"
              />
              <p className="text-blue-700 text-sm">
                This information will help us customize your tour experience to better suit your needs.
              </p>
            </div>
          </div>

          {/* Inclusions & Exclusions */}
          <div className="grid md:grid-cols-2 gap-6">
            <div className="bg-blue-50/70 backdrop-blur-sm rounded-xl p-6 border border-blue-200">
              <h3 className="text-xl font-bold text-blue-900 mb-4 flex items-center">
                <Check className="w-5 h-5 mr-2 text-green-600" />
                Includes
              </h3>
              <ul className="space-y-2">
                {inclusions.map((item, index) => (
                  <li key={index} className="flex items-start space-x-2">
                    <Check className="w-4 h-4 text-green-600 mt-0.5 flex-shrink-0" />
                    <span className="text-blue-800 text-sm">{item}</span>
                  </li>
                ))}
              </ul>
            </div>

            <div className="bg-blue-50/70 backdrop-blur-sm rounded-xl p-6 border border-blue-200">
              <h3 className="text-xl font-bold text-blue-900 mb-4 flex items-center">
                <X className="w-5 h-5 mr-2 text-red-500" />
                Excludes
              </h3>
              <ul className="space-y-2">
                {exclusions.map((item, index) => (
                  <li key={index} className="flex items-start space-x-2">
                    <X className="w-4 h-4 text-red-500 mt-0.5 flex-shrink-0" />
                    <span className="text-blue-800 text-sm">{item}</span>
                  </li>
                ))}
              </ul>
            </div>
          </div>
        </div>

        {/* Booking Summary */}
        <div className="bg-white rounded-xl shadow-lg p-6 h-fit border border-blue-200">
          <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
            <Camera className="w-5 h-5 mr-2" />
            Book Your Adventure
          </h3>

          <div className="space-y-4">
            <div className="bg-blue-50 p-4 rounded-lg border border-blue-200">
              <div className="flex justify-between items-center mb-2">
                <span className="text-blue-700">Duration</span>
                <span className="font-semibold flex items-center text-blue-900">
                  <Calendar className="w-4 h-4 mr-1" />
                  6 days
                </span>
              </div>
              <div className="flex justify-between items-center mb-2">
                <span className="text-blue-700">Travelers</span>
                <span className="font-semibold text-blue-900">{travelers} person{travelers > 1 ? 's' : ''}</span>
              </div>
              <div className="flex justify-between items-center">
                <span className="text-blue-700">Package</span>
                <span className="font-semibold capitalize text-blue-900">{selectedPackage}</span>
              </div>
            </div>

            <div className="border-t border-blue-200 pt-4">
              <div className="flex justify-between items-center text-xl font-bold">
                <span className="text-gray-800">Total Cost</span>
                <span className="text-green-600">${getTotalPrice().toLocaleString()}</span>
              </div>
              <p className="text-blue-600 text-sm mt-1">
                {travelers === 1 ? 'Single rate' : `$${packageRates[selectedPackage].double} per person`}
              </p>
            </div>

            <BookingForm 
              packageType={`6-day-cultural-triangle-wildlife-west-coast-${selectedPackage}`}
              travelers={travelers}
              totalCost={getTotalPrice()}
              initialComments={comments}
            />
          </div>
        </div>
      </div>
    </div>
  );
};

export default SixDayTourPackage;